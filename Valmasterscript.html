<script>
window.onload = function() {
  const params = new URLSearchParams(window.location.search);

  // Read both group sources (transfer calls often populate user_group)
  const groupRaw     = params.get('group') || '';
  const userGroupRaw = params.get('user_group') || '';
  const commentsRaw  = params.get('comments') || '';

  const group     = groupRaw.toUpperCase().trim();
  const userGroup = userGroupRaw.toUpperCase().trim();
  const comments  = commentsRaw.toLowerCase();

  const baseURL = "https://paulpccu.github.io/Valid_scripts/";
  let targetFile = "TapValidtest.html"; // fallback

  // Helper: test if ANY of the group-like fields matches a condition
  const anyGroup = (predicate) => [group, userGroup].some(g => predicate(g));

  // ---- TAPS logic (interactive rebuttal only here) ----
  const isTaps = anyGroup(g =>
    g.includes("TAPS") ||
    g.includes("MIXED PAC BIG SALES") ||
    g.includes("MIXED PACSBIGSALES") ||
    g.includes("MIXEDPACSBIGSALES") ||
    g.includes("MIXEDPACS SALES") ||
    g.includes("MIXEDPACSSALES") ||
    g.includes("MIXEDPOLICEANDFSALES") ||
    g.includes("MIXEDPANDFBIGSALES")
  );

  if (isTaps) {
    // Only TAPS gets the interactive credit-based split
    targetFile = comments.includes("credit")
      ? "TapValid_Credit.html"
      : "TapValid.html";
  }

  // ---- XTAPC logic ----
  else if (anyGroup(g =>
    g.includes("XTAPC") ||
    g.includes("MIXED CAMPAIGN 2 SALES") ||
    g.includes("MIXEDCAMPAIGN2SALES") ||
    g.includes("MIXEDPACS2SALES") ||
    g.includes("MIXEDCAMP2BIGSALES")
  )) {
    targetFile = "XtapcValid.html";
  }

  // ---- NP logic ----
  else if (anyGroup(g =>
    g.includes("NP") ||
    g.includes("NON PAID SALES") ||
    g.includes("NONPAIDSALES BIG")
  )) {
    targetFile = "NpValid.html";
  }

  // Preserve all VICIdial params (first_name, city, etc.)
  const queryString = window.location.search;

  // Redirect inside the iframe
  window.location.replace(baseURL + targetFile + queryString);
};
</script>

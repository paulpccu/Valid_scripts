<script>
window.onload = function() {
  const params = new URLSearchParams(window.location.search);
  const groupRaw = params.get('group') || '';
  const commentsRaw = params.get('comments') || '';
  const group = groupRaw.toUpperCase().trim();
  const comments = commentsRaw.toLowerCase();

  const baseURL = "https://paulpccu.github.io/Valid_scripts/";
  let targetFile = "TapValidtest.html"; // Default fallback

  // ðŸ”¹ TAPS Logic 
  if (
    group.includes("TAPS") ||
    group.includes("MIXED PAC BIG SALES") ||
    group.includes("MIXED PACSBIGSALES") ||
    group.includes("MIXEDPACSBIGSALES") ||
    group.includes("MIXEDPACS SALES") ||
    group.includes("MIXEDPACSSALES") ||
    group.includes("MIXEDPOLICEANDFSALES") ||
    group.includes("MIXEDPANDFBIGSALES")
  ) {
    //  Check for the word "credit" in the comments
    if (comments.includes("credit")) {
      // Customer used a card before â†’ load special rebuttal version
      targetFile = "TapValid_Credit.html";
    } else {
      // Regular TAPS script
      targetFile = "TapValid.html";
    }
  }

  // ðŸ”¹ XTAPC Logic
  else if (
    group.includes("XTAPC") ||
    group.includes("MIXED CAMPAIGN 2 SALES") ||
    group.includes("MIXEDCAMPAIGN2SALES") ||
    group.includes("MIXEDPACS2SALES") ||
    group.includes("MIXEDCAMP2BIGSALES")
  ) {
    targetFile = "XtapcValid.html";
  }

  // ðŸ”¹ NP Logic
  else if (
    group.includes("NP") ||
    group.includes("NON PAID SALES") ||
    group.includes("NONPAIDSALES BIG")
  ) {
    targetFile = "NpValid.html";
  }

  // Preserve VICIdial parameters
  const queryString = window.location.search;

  // Redirect inside iframe
  window.location.replace(baseURL + targetFile + queryString);
};
</script>

